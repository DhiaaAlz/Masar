@using AlwasataNew.Data;
@using System.Security.Claims;
@model Customer
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

<style>
    .allComments
    {
        display:flex;
        justify-content:center;
        flex-direction:column;
        align-items:center;
        margin-top:40px;
    }
    .comment
    {
        position:relative;
        display: flex;
        justify-content: center;
        padding: 30px;
        width: 100%;
        border: 1px solid;
        border-radius: 5px;
        margin: 10px;
        font-weight:bold;
    }
    .createAt
    {
        position:absolute;
        right:5px;
        bottom:1px;
        color:darkcyan;
    }
    .empName
    {
        position:absolute;
        left:10px;
        top:2px;
        color:darkgreen;
    }

    #callsBtn, #whatsAppBtn, #emailBtn{
        display: flex;
        justify-content:center;
        align-items:center;
        padding:3px;
        gap:10px;
    }
</style>
  
@{
    var userId = "";
    var customerName = "";
}

@using (var dbContext = new ApplicationDbContext())
{

    userId = User.FindFirstValue(ClaimTypes.NameIdentifier);

    customerName = dbContext.Customers.Where(x => x.Id == Model.Id).Select(x => x.CustomerName).FirstOrDefault();

    if (customerName == null)
    {
        customerName =" شركة "+ dbContext.Customers.Where(x => x.Id == Model.Id).Select(x => x.CompanyName).FirstOrDefault();
    }

}

<div class="container">
     <form method="post" class="fromInput">
        <h4 style="margin-top:20px;text-align:center">اسم العميل : @customerName</h4>
        <hr />
        <h3 style="text-align:center">اكتب تعليقاً لحالة هذا العميل</h3>
        <input type="hidden" value="@Model.Id" name="customerId"/>
        <input type="hidden" value="@userId" name="employeeId"/>
        <textarea name="comment" style="padding: 10px;border-radius: 6px;" id="comment">

        </textarea>
        <button class="btn btn-primary" type="submit">حسناً</button>

        <button id="emailBtn" type="submit" class="btn btn-primary" style="background-color:#128C7E;margin-top:15px;"> <i class="fa-regular fa-envelope fa-2x"></i>تم التواصل عن طريق الايميل  </button>
        <button id="whatsAppBtn" type="submit" class="btn btn-primary" style="background-color:#25D366"><i class="fa-brands fa-whatsapp fa-2x"></i>تم التواصل عن طريق الواتس اب</button>
        <button id="callsBtn" type="submit" class="btn btn-primary" style="background-color:#34B7F1"> <i class="fa-solid fa-phone fa-2x"></i> تم التواصل عن طريق المكالمات</button>

     </form>
    
    <div class="allComments">
        <h3 style="color:darkred">جميع التعليقات السابقة</h3>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    @{
                        using var dbContextt = new ApplicationDbContext();

                        var result = dbContextt.CustomerStateDescriptions.Where(x => x.CustomerId == Model.Id).ToList();

                        if(result.Count() == 0)
                        {
                            <span class="comment">
                                <span style="color:darkred;text-align:center">لا يوجد تعليقات <i class="fa-solid fa-comment-slash"></i></span>
                            </span>
                        }
                        else
                        {
                            @foreach (var item in result)
                            {
                                <span class="comment">
                                    @item.CommentText
                                    <span class="empName">
                                        @{
                                            var empName = dbContextt.Users.Where(x => x.Id == item.EmployeeId).Select(x => new { firstName = x.FirstName, lastName = x.LastName }).FirstOrDefault();
                                            @empName.firstName <span> </span> @empName.lastName
                                        }
                                    </span>
                                    <span class="createAt">
                                        @item.CreatedAt 
                                    </span>
                                </span>
                            }
                        }
                        
                    }
                    
                </div>
            </div>
        </div>
    </div>
</div>
<script src="./lib/jquery/dist/jquery.min.js"></script>
<script>
    document.getElementById("emailBtn").addEventListener("click", function ()
    {
        document.getElementById("comment").value = 'تم التواصل عن طريق الايميل';
    });

    document.getElementById("callsBtn").addEventListener("click", function () {
        document.getElementById("comment").value = 'تم التواصل عن طريق المكالمات';
    });

    document.getElementById("whatsAppBtn").addEventListener("click", function () {
        document.getElementById("comment").value = 'تم التواصل عن طريق الواتس اب';
    });
</script>